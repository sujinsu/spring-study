# SSL (Sesure Socket Layer)

### λ°°κ²½

> μ•”νΈν™” : λ€μΉ­ν‚¤ μ•”νΈ(κ³µν†µμ μΌλ΅ μ•κ³  μλ” ν‚¤) , λΉ„λ€μΉ­ν‚¤ μ•”νΈ (μ„λ΅ λ‹¤λ¥Έ ν‚¤)
>
> λ€μΉ­ν‚¤ - (+) : μ†λ„κ°€ λΉ λ¦„ 
>
> 			-  (-) : ν‚¤ κ³µμ  κ³Όμ • ν•„μ”, μ™Έλ¶€λ΅μ λ…Έμ¶ λ°μƒ β†’ κ°€λ΅μ±λ‹¤λ©΄ ν° ν”Όν•΄ 
>
> λΉ„λ€μΉ­ν‚¤ - (-) : λλ¦¬κ³  λΉ„ν¨μ¨μ 



<aside> π’΅ μ²μ λ€μΉ­ν‚¤λ¥Ό κµν™ν•  λ•λ§ λΉ„λ€μΉ­ν‚¤ μ•”νΈλ¥Ό μ‚¬μ© ! β†’ TLS μ μ—­ν• 





### λ³΄μ• κΈ°λ¥

- κΈ°λ°€μ„±
  - λ°μ΄ν„°λ¥Ό ν›”μ³κ°€λ„ λ³Ό μ μ—†μ
- λ¬΄κ²°μ„±
  - λ©”μ‹μ§€ μΈμ¦ μ½”λ“ (MAC: Message Authentication Code) λ¥Ό ν†µν•΄ μΈμ¦ μ κ³µ
  - μ„λ³€μ΅° μ—¬λ¶€ ν™•μΈ
- μΈμ¦
  - μ—°κ²° μ΄κΈ° μ„¤μ •μ—μ„ μ£Όκ³ λ°›λ” μΈμ¦μ„λ¥Ό ν†µν•΄ μ‹ λΆ°ν•  μ μλ” κ°μ²΄μΈμ§€ μΈμ¦









![](images/WEEK20.assets/TLS.png)

- μ „μ†΅ κ³„μΈµ μ„μ—μ„ TLS κ³„μΈµμ„ λ”°λ΅ λ‘μ–΄ λ™μ‘
- TLS μ‚¬μ© μ–΄ν”λ¦¬μΌ€μ΄μ… ν”„λ΅ν† μ½μ€ λμ— sκ°€ λ¶™μ (HTTPS, FTPS)





### TLSμ μ„Έλ¶€ ν”„λ΅ν† μ½

- Handshake
  - μ–‘μ½ κ°„μ— μ—°κ²°μ„ μ„¤μ •ν•  λ• λ³΄μ• ν‘μƒμ„ μ„ν• ν”„λ΅ν† μ½
- Change Cipher Spec
  - λ³΄μ• νλΌλ―Έν„° λ³€κ²½ λ° μ μ© μ‹ μ‚¬μ©
  - ex) λ€μΉ­ν‚¤ μ•κ³ λ¦¬μ¦ λ³€κ²½ μ‹ ν”„λ΅ν† μ½ μ‚¬μ©
- Alert
  - μ¤λ¥ μ „μ†΅ μ‹ μ‚¬μ©ν•λ” ν”„λ΅ν† μ½
- Application Data
  - μ‹¤μ  λ°μ΄ν„° μ „μ†΅λ  λ• μ‚¬μ©λλ” ν”„λ΅ν† μ½
- Record
  - ν‘μƒλ λ³΄μ• νλΌλ―Έν„°λ¥Ό μ΄μ©ν•μ—¬ μ•”, λ³µνΈν™”, λ¬΄κ²°μ„± κ²€μ¦ λ“±μ„ μν–‰ν•λ” ν”„λ΅ν† μ½

 

```
π’΅ Handshake

TLS λ” μ„Έμ…κ³Ό μ—°κ²° λ³„λ΅ μƒνƒ μ •λ³΄λ¥Ό μ μ§€ν•©λ‹λ‹¤. 
Full Handshakeλ¥Ό ν†µν•΄ μ„Έμ… μƒμ„± 
μ„Έμ… μ •λ³΄λ¥Ό κ³µμ ν•λ” μ—¬λ¬ μ—°κ²° μ„±λ¦½

β΅ Abbreviation Handshake : μ„Έμ…μ΄ μ΄λ―Έ μ΅΄μ¬ν•  λ• μ‚¬μ© 
β΅ Full Handshake : μ„Έμ… μƒμ„±

μ—°κ²° : μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„ ν†µμ‹ μ λ‹¨μ„

μ„Έμ… : μ—°κ²°μ λ‹¤μ

μ„Έμ…μ€ ν•λ² μ„±λ¦½λλ©΄ λ‹¤μ μ—°κ²°μ„ μ„ν•΄ μƒνƒ μ μ§€(sessionId λ“±) ν•  μ μμ 

ex) ν• λ²μ μ—°κ²°μ—μ„ μ•”νΈν™” λ°©μ‹, μΈμ¦μ„ κµν™, session id κ³µμ  
β†’ ν•  μΌ λλ‚ μ—°κ²° λμ 
β†’ λ‹¤μ μ—°κ²°μ— μ΄ μ„Έμ… μ •λ³΄λ¥Ό μ΄μ©ν•μ—¬ μ—°κ²° κ°€λ¥
```







![](images/WEEK20.assets/handshake.png)



π’§**1. Client Hello**

- random

  - 32λ°”μ΄νΈ λ‚μ κ°’ for λΉ„λ°€ λ°μ΄ν„° (master secret)

- session ID

  - μ²μ μƒμ„± μ‹ λΉ κ°’, μ΄λ―Έ μƒμ„±λ μ„Έμ…μ΄ μλ‹¤λ©΄ κ·Έ μ„Έμ… ID

- Cipher suite

  - ν΄λΌμ΄μ–ΈνΈκ°€ μ§€μ› κ°€λ¥ν• ν‚¤ κµν™ μ•κ³ λ¦¬μ¦, λ€μΉ­ν‚¤ μ•”νΈ μ•κ³ λ¦¬μ¦, ν•΄μ‹ μ•κ³ λ¦¬μ¦

  - μ„λ²„λ” μ΄ μ¤‘μ— μµμ μ λ°©μ‹ μ„ νƒ

  - ex) 

    TLS_RSA_WITH_AES_128_GCM_SHA256

    - ν‚¤κµν™ μ•κ³ λ¦¬μ¦ : RSA
    - λ€μΉ­ν‚¤ μ•κ³ λ¦¬μ¦ : AES_128_GCM
    - ν•΄μ‹ μ•κ³ λ¦¬μ¦ : SHA256

π©Έ **2. Server Hello**

μ‚¬μ©ν•  tls λ²„μ „, μ§€μ› κ°€λ¥ν• μµμ μ Cipher suite, μ••μ¶• λ°©μ‹ λ“±μ„ clientμ—κ² μ „λ‹¬

- random
  - 32λ°”μ΄νΈ λ‚μ κ°’ for λΉ„λ°€ κ°’ (master secret)
- session ID
  - μ„Έμ… μ •λ³΄

**π©Έ 3. Server certificate**

ν•΄λ‹Ή μΈμ¦μ„λ¥Ό μ΄μ©ν•μ—¬ ν΄λΌμ΄μ–ΈνΈλ” λ―Ώμ„λ§ν• μ„λ²„μΈμ§€ ν™•μΈ

**π©Έ 4. Server Key exchange**

ν‚¤ κµν™μ— ν•„μ”ν• μ •λ³΄ μ κ³µ

ex) ν‚¤κµν™ μ•κ³ λ¦¬μ¦ Diffie-Hellman μ‚¬μ© β†’ μ†μ, μ›μ‹κ·Ό ν•„μ” β†’ μ΄λ¥Ό μ „μ†΅

**π©Έ 5. Certificate request**

μ„λ²„ μ—­μ‹ ν΄λΌμ΄μ–ΈνΈμ—κ² μΈμ¦μ„ μ”κµ¬ κ°€λ¥ (ν•μ§€ μ•μ„ μλ„ μμ)

**π©Έ 6. Server hello done**

π’§**7. Certificate**

μ„λ²„κ°€ μ”μ²­ν• μΈμ¦μ„ μ¤ (μ”μ²­ν•μ§€ μ•μ•λ‹¤λ©΄ X)

π’§**8. Certificate**

ν‚¤κµν™ ν•„μ” μ •λ³΄(pre-master secret) λ¥Ό μ„λ²„μ— μ κ³µ

```java
**ν΄λΌμ΄μ–ΈνΈ** : μ„λ²„μ λλ¤κ°’, ν΄λΌμ΄μ–ΈνΈ λλ¤κ°’ μ΅°ν•©ν•μ—¬ μ•”νΈν™”ν•΄ μ „μ†΅  (λ€μΉ­ν‚¤)

							λ°›μ€ μΈμ¦μ„ μ• μ„λ²„μ κ³µκ°ν‚¤λ΅ μ•”νΈν™” 

**μ„λ²„** : pre-master secretμ„ μμ‹ μ κ°μΈν‚¤λ΅ λ³µνΈν™”

-> pre-master secret κ³µμ  μ„±κ³µ -> master secretμΌλ΅ λ§λ“¦
```

π’§**9. Certificate verify**

ν΄λΌμ΄μ–ΈνΈκ°€ Certificate request λ¥Ό λ°›μ•λ‹¤λ©΄ λ³΄λ‚Έ μΈμ¦μ„μ— λ€ν• κ°μΈν‚¤ μμ

handshake κ³Όμ •μ μ£Όκ³ λ°›μ€ λ©”μ‹μ§€ + master secret μ΅°ν•©ν• hash κ°’μ—

κ°μΈν‚¤λ΅ λ””μ§€ν„Έ μ„λ…ν•μ—¬ μ „μ†΅

π’§**10. Change cipher spec**

ν‘μƒλ λ³΄μ• νλΌλ―Έν„° μ μ© λ° λ³€κ²½ μ‹ μ„λ²„μ—κ² μ•λ¦Ό

π’§**11. Finished**

ν΄λΌμ΄μ–ΈνΈ λ

**π©Έ 12. Change cipher spec**

ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄μ• νλΌλ―Έν„° λ³€κ²½ μ•λ¦Ό

**π©Έ 13. FInished**

μ„λ²„λ„ λ

π‹οΈβ€β™‚οΈ **14. ν†µμ‹ **

μ£Όκ³ λ°›μ€ λΉ„λ°€ν‚¤λ¥Ό ν†µν•΄ μ•μ „ν•κ² ν†µμ‹  !







------

# TCP

IP κ³„μΈµ μ„μ—μ„ λ™μ‘ν•λ”  TCPλ” μ—°κ²° μ§€ν–¥ ν”„λ΅ν† μ½

μ •ν™•ν• λ°μ΄ν„° μ „μ†΅ μ”κµ¬, μ‹ λΆ°ν•  μ μλ” ν”„λ΅ν† μ½ (Reliable Protocol)



### μ‹ λΆ°μ„± λ³΄μ¥μ„ μ„ν• μ μ–΄

- νλ¦„ μ μ–΄ (Flow Control)
  - μƒλ€κ°€ λ°›μ„ μ μλ” λ§νΌμ μ–‘
- νΌμ΅ μ μ–΄ (Congestion Control)
  - λ„¤νΈμ›ν¬ νΌμ΅ μ‹ μ†΅μ‹ μκ°€ λ°μ΄ν„° μ „μ†΅λ‰ μ μ–΄
  - λ°μ΄ν„° μ†μ‹¤ λ°μƒ λ§μ•„μ§ μ‹ β†’ νΌμ΅ μƒνƒ νλ‹¨
- μ¤λ¥ μ μ–΄ (Error Control)
  - μ¤λ¥ λ°μƒ μ‹ TCPλ” λ°μ΄ν„° μ¬μ „μ†΅



### TCP ν—¤λ”

- μ‹ λΆ°μ„± λ³΄μ¥μ„ μ„ν•΄ λ§μ€ μ •λ³΄ ν¬ν•¨

![](images/WEEK20.assets/TCP-header.png)







**Control Flags**

| FLAG                              | μ„¤λ…                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| URG (Urgent Pointer)              | Urgent Pointerμ ν•„λ“κ°€ μ ν¨ν•λ‹¤λ” μλ―Έμ FLAG               |
| ACK(Acknowledgement)              | μμ‹  ν™•μΈ μ‘λ‹µ FLAG                                          |
| PSH (Request for push)            | μ†΅μμ‹  λ²„νΌμ μλ” λ°μ΄ν„° μ¦‰μ‹ μ²λ¦¬ μ”μ²­ FLAG                |
| RST (Reset the connection)        | μ—°κ²°μ„ κ°•μ  μ¤‘λ‹¨ν•©λ‹λ‹¤. TCPκ°€ μ μ§€λκ³  μμ„λ• μ΄ FLAGλ¥Ό μ‚¬μ©ν•λ©΄ κ·Έ μ¦‰μ‹ μ—°κ²°μ„ λμ–΄ λ²„λ¦½λ‹λ‹¤. ν•΄μ»¤λ“¤μ΄ Hijackingμ„ μ„ν•΄ ν”Όν•΄μμ μ—°κ²°μ„ λμ–΄λ²„λ¦΄λ• μ‚¬μ©ν•©λ‹λ‹¤. λ³΄ν†µμ μ •μƒμ μΈ μΆ…λ£λ” μ•„λμ FIN FLAGλ¥Ό μ„¤μ •ν•©λ‹λ‹¤. |
| SYN (Synchronize sequence number) | μ—°κ²° μ„¤μ • FLAG                                               |
| FIN(Terminate the connection)     | μ •μƒ μΆ…λ£μ μ—°κ²° μΆ…λ£ FLAG                                   |







## TCP μ—°κ²° μ„¤μ • κ³Όμ • (3-way handshake)

3λ‹¨κ³„ μ μ°¨λ¥Ό ν†µν•΄ μ—°κ²° μ„±λ¦½

FLAG 2κ°€μ§€ μ‚¬μ© (SYN, ACK)



![](images/WEEK20.assets/3wayHandshake.png)

- μµμ΄ ν΄λΌμ΄μ–ΈνΈ μ½μ—μ„ SYN FLAGμ™€ SeqNumber λ¥Ό μ„μλ΅ μ„¤μ •ν•μ—¬ λ³΄λ‚΄μ¤
  - μµμ΄ SeqNumber  : ISN (Initial Sequence Number)
  - μ•„μ§ μƒλ€λ°©μ—κ²μ„ λ°μ΄ν„° μμ‹  X β†’ ACK ν•„λ“ λΉ„μ–΄μμ
  - ν΄λΌμ΄μ–ΈνΈμ μ κ·Ήμ μΈ μ—°κ²° μ”μ²­ : `Active Open`
  - μλ™μ μΈ μ„λ²„ : `Passive Open`
- μ„λ²„μ—μ„ λ™κΈ°ν™” μ”μ²­μ„ λ°›μ•μΌλ©΄ μ λ°›μ•λ‹¤κ³  μ—°κ²° μ”μ²­
  - ν΄λΌμ΄μ–ΈνΈμ—μ„ λ³΄λ‚Έ Seq μ— +1 ν•μ—¬ ACK number β†’ λ‹¤μ Seq Number μ”κµ¬
  - ISN μ„¤μ •
  - ACK, SYN ν”λκ·Έ μ‚¬μ© (λ‘ λ‹¤ μ ν¨ν• λ°μ΄ν„°)
  - ν¨ν‚· μ „μ†΅ ν›„ μ„λ²„λ” μ—°κ²° ν™•λ¦½ μƒνƒ (ESTABLISHED)
- ν΄λΌμ΄μ–ΈνΈλ” μ΄μ— λ€ν• μ‘λ‹µμΌλ΅ μ„λ²„μ—κ² ACK num μ„¤μ •ν•μ—¬ λ³΄λƒ„
  - μ΄ν›„ ν΄λΌμ΄μ–ΈνΈλ„ μ—°κ²° ν™•λ¦½ μƒνƒ (ESTABLISHED)

![](images/WEEK20.assets/3way.png)







## μ—°κ²° μΆ…λ£ (4-way handshake)

μ •μƒμ μΈ μ—°κ²° μΆ…λ£λ” FIN, ACK μ ν”λκ·Έλ¥Ό ν†µν•΄ μ΄λ£¨μ–΄μ§

![](images/WEEK20.assets/4wayHandshake.png)

- μ—°κ²° μƒνƒμ— μλ ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²° μΆ…λ£λ¥Ό μ„ν•΄ `FIN` λ³΄λƒ„
  - close μ”μ²­ν• μ½ : `Active Close`
  - close μ”μ²­ λ°›μ€ μ½ : `Passive Close`
- μμ‹ ν•λ” μ„λ²„λ” μ‘λ‹µμΌλ΅ `ACK` λ¥Ό λ³΄λƒ„
- μ„λ²„λ” μ΄ν›„ μ†μΌ“μ„ λ°›λ” μ‹μ¤ν… μ½(close) νΈμ¶ μ „κΉμ§€ λ€κΈ° μƒνƒ, μ†μΌ“ μΆ…λ£ ν›„ `FIN` + `ACK`λ³΄λƒ„
- μ„λ²„λ΅λ¶€ν„° `FIN` μ„ λ°›μ€ ν΄λΌμ΄μ–ΈνΈλ” `ACK` μ‘λ‹µμ„ ν•μ—¬ 2MSLλ§νΌμ μ‹κ°„(λ³΄ν†µ 1~4λ¶„) μ΄ν›„ μ—°κ²° μΆ…λ£ μƒνƒ (CLOSED)